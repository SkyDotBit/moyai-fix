(function(c,n,f,i,T,r){"use strict";const{ScrollView:A}=r.General,{FormSwitchRow:g}=r.Forms,{View:m}=i.ReactNative;function C(){return T.useProxy(n.storage),React.createElement(React.Fragment,null,React.createElement(A,{style:{flex:1}},React.createElement(g,{label:"Play on reactions :O",value:n.storage.allowReactions??!0,onValueChange:function(e){n.storage.allowReactions=e},style:{marginBottom:20,marginTop:20}}),React.createElement(m,{style:{height:1,backgroundColor:"#ccc",marginVertical:10}}),React.createElement(r.Forms.FormInput,{title:"\u{1F5FF} Custom Sound URL",placeholder:"https://github.com/SkyDotBit/moyai-fix/raw/refs/heads/main/thud.mp3",onChangeText:function(e){return n.storage.customUrl=e},style:{marginTop:20,marginHorizontal:12,marginVertical:10}}),React.createElement(m,{style:{height:1,backgroundColor:"#ccc",marginVertical:10}}),React.createElement(r.Forms.FormInput,{title:"\u{1F5FF} Custom emoji (Does not support Nitro emojis/FreeNitro emojis)",placeholder:"\u{1F5FF}",onChangeText:function(e){return n.storage.customEmoji=e},style:{marginTop:20,marginHorizontal:12,marginVertical:10}}),React.createElement(m,{style:{height:1,backgroundColor:"#ccc",marginVertical:10}}),React.createElement(g,{label:"Ignore silent mode",value:n.storage.ignoreSilent??!1,onValueChange:function(e){n.storage.ignoreSilent=e},style:{marginBottom:20}})))}function k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var o=0;o<t.length;o++){var a=t[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function D(e,t,o){return t&&y(e.prototype,t),o&&y(e,o),e}const j=f.findByProps("MobileAudioSound").MobileAudioSound;let S=function(){function e(t,o,a,x){k(this,e),this.url=t,this.usage=o,this.volume=a,this.mas=new j(t,{media:"vibing_wumpus",notification:"activity_launch",ring_tone:"call_ringing",voice:"mute"}[o],a,"default"),this.mas.volume=a,this._preloadSound();for(const[N,V]of Object.entries(x??{}))this[N]=V}return D(e,[{key:"ensureSoundGetter",get:function(){return this.mas?._ensureSound||this.mas?.ensureSound}},{key:"_preloadSound",value:async function(t){const{_duration:o}=await this.ensureSoundGetter.bind(this.mas)();return this.duration=i.ReactNative.Platform.select({ios:o&&o*1e3,default:o}),this.isLoaded=!!o,t||this.onLoad?.(!!o),!!o}},{key:"play",value:async function(){var t=this;!this.isLoaded&&this.isLoaded!==!1&&await this._preloadSound(),this.isLoaded&&(this.mas.volume=this.volume,await this.mas.play(),this.isPlaying=!0,this.onPlay?.(),clearTimeout(this._playTimeout),this._playTimeout=setTimeout(function(){return t.onEnd?.(),t.stop()},this.duration))}},{key:"stop",value:async function(){this.isLoaded&&(this.mas.stop(),this.isPlaying=!1,this.onStop?.(),clearTimeout(this._playTimeout),await this._preloadSound(!0))}}]),e}();const{DCDSoundManager:s}=i.ReactNative.NativeModules,b=f.findByStoreName("SelectedChannelStore");if(n.storage.ignoreSilent??!1)try{s.setCategory("Playback",!0)}catch(e){console.error(e+"This is an old version of the code thing please know that this is not something you should worry about I was just too lazy to remove it - Sky.Bit")}let E="https://github.com/SkyDotBit/moyai-fix/raw/refs/heads/main/thud.mp3";n.storage.customUrl&&(E=n.storage.customUrl);let P=new S("https://github.com/SkyDotBit/moyai-fix/raw/refs/heads/main/thud.mp3","notification",1,{onPlay:function(){return console.log("Audio started playing")},onStop:function(){return console.log("Audio stopped")},onEnd:function(){return console.log("Audio finished")},onLoad:function(e){return console.log("Audio loaded:",e)}}),d="\u{1F5FF}";n.storage.customEmoji&&(d=n.storage.customEmoji);const l=6969;let v=-1;const p=function(){return new Promise(function(e){console.log("Hi"),n.storage.ignoreSilent??!1?n.storage.customUrl&&(console.log("There is a custom URL"),new S(n.storage.customUrl,"notification",1,{onPlay:function(){return console.log("Audio started playing")},onStop:function(){return console.log("Audio stopped")},onEnd:function(){return console.log("Audio finished")},onLoad:function(t){return console.log("Audio loaded:",t)}})):s.prepare(E,"notification",l,function(t,o){return e(o)})})};let h=null,u=!1;async function I(){u&&(h!=null&&clearTimeout(h),s.stop(l),u=!1),u=!0,await s.play(l),setTimeout(function(){u=!1,s.stop(l),h=null},v)}async function L(){P.play()}function _(){p(),n.storage.ignoreSilent??!1?L():I()}function w(e){if(e.message.content&&e.channelId==b.getChannelId()&&!e.message.state&&e.sendMessageOptions==null){let t=(e.message.content.match(d)??[]).length;if(t+=(e.message.content.match(/<a?:.*?moy?ai.*?:.+?>/gi)??[]).length,t>0)for(let o=0;o<t;o++)setTimeout(_,o*350)}}function F(e){(n.storage.allowReactions??!0)&&e.channelId==b.getChannelId()&&(e.emoji.name==d||e.emoji.name.match(/.*?moy?ai.*?/i))&&!e.optimistic&&_()}let R=!1;var M={onLoad:function(){R||p().then(function(e){R=!0,v=e.duration}),i.FluxDispatcher.subscribe("MESSAGE_CREATE",w),i.FluxDispatcher.subscribe("MESSAGE_REACTION_ADD",F)},onUnload:function(){i.FluxDispatcher.unsubscribe("MESSAGE_CREATE",w),i.FluxDispatcher.unsubscribe("MESSAGE_REACTION_ADD",F)},settings:C};return c.default=M,Object.defineProperty(c,"__esModule",{value:!0}),c})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.storage,vendetta.ui.components);
